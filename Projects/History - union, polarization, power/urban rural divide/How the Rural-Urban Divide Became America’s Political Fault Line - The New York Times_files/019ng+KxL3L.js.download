define("ImageBuilder",[window,"EventUtils"],function(f,h,k){var l=function(a){var e=new Image;h.attach({event:"error",element:e,callback:function(){f.showFallback(Error("ib:image-load-error"))}});e.src=a};return function(a){var e=this;this.url=a;var g=function(){return f.devicePixelRatio===k||1>f.devicePixelRatio?1:f.devicePixelRatio};a=function(m){return function(){var b;b=e.url;var d=m.apply(null,Array.prototype.slice.call(arguments));if(d){var c=b.lastIndexOf("."),a=b.lastIndexOf("/"),c=c>a?c:
b.length,a=b.slice(0,c);"_"!==b.slice(c-1,c)&&(a+="._");a+=d;"_"!==d.slice(d.length-1,d.length)&&(a+="_");b=a+=b.substring(c)}else b=void 0;e.url=b;return e}};this.autoCrop=a(function(){return"AC"});this.scaleToRectangle=a(function(a,b){var d,c;d=a>b?a:b;c=g();500<c*d&&(c=500/d);d=Math.floor(a*c);c=Math.floor(b*c);var e="";if(a!==d||b!==c)e="UX"+d+"_";return e+"SR"+d+","+c});this.brightness=a(function(a){return"BR"+a});this.greyscale=a(function(){return"GR"});this.scaleX=a(function(a){return"SX"+
Math.floor(a*g())});this.scaleY=a(function(a){return"SY"+Math.floor(a*g())});this.scaleLongest=a(function(a){return"SL"+a});this.border=a(function(a,b,d,c){return"BO"+a+","+b+","+d+","+c});this.background=a(function(a,b,d){return"BG"+a+","+b+","+d});this.build=function(){return this.url};this.preloadAndBuild=function(){l(this.url);return this.url}}});