window.define("ClientSideMetrics",["JSONUtils","ClientSideUtils","EventUtils",window,document],function(n,m,u,e,k){function s(p,a,h,e,f,g,k,r,c,v){return p+"/event/"+a+"?"+("arid\x3d"+h+"\x26abid\x3d"+e+(g?"\x26testing\x3dtrue":"")+"\x26hsi\x3d"+k+"\x26hci\x3d"+r+"\x26prts\x3d"+c+"\x26rst\x3d"+v)+"\x26ev\x3d"+encodeURIComponent(n.from(f))}function g(a,e,h,g,f){f={tags:f||"fallback",type:"error",clientEventTime:(new Date).getTime()};a&&(f.message="[object Error]"===Object.prototype.toString.apply(a)?
a.message:a);e&&(f.url=e);h&&(f.lineNumber=h);g&&(f.columnNumber=g);return f}function w(){var a={},l=k.documentElement,h=k.getElementsByTagName("body")[0];a.viewportSize=(window.innerWidth||l.clientWidth||h.clientWidth)+"x"+(window.innerHeight||l.clientHeight||h.clientHeight);window.performance&&window.performance.timing?(a.navigationStartTime=window.performance.timing.navigationStart,a.clientStartTime=window.performance.timing.domLoading,a.clientEndTime=window.performance.timing.domComplete):(a.clientStartTime=
t,a.clientEndTime=(new Date).getTime());window.performance&&window.performance.navigation&&(a.navigationType=window.performance.navigation.type,a.navigationRedirectCount=window.performance.navigation.redirectCount);e.navigator&&e.navigator.a&&(a.connectionDownlink=e.navigator.a.c,a.connectionRtt=e.navigator.a.e,a.connectionEffectiveType=e.navigator.a.d);l=window.registerFallbackHandler||function(){};try{window.location&&(a.clientProtocol=window.location.protocol)}catch(q){l("cse",g("Failed window.location: "+
q,void 0,void 0,void 0,"ignored"))}try{window.parent&&window.parent===window&&(a.adNotInIframe=!0)}catch(f){l("cse",g("Failed window.parent: "+f,void 0,void 0,void 0,"ignored"))}window.JSON&&window.JSON.stringify||(a.noNativeJson=!0);"string"===typeof k.compatMode&&(a.inQuirksMode="CSS1Compat"!==k.compatMode);return a}var t=(new Date).getTime(),a=m.Metric,x=u.getClickXY,y=new m.PixelQueue;return{init:function(p,l,h,q,f,m,n,r){var c=function(){return function(a,c){var b=new Image;b.src=s(p,a,l,h,c,
q,f,m,n,r);b.style.display="none";b.width=b.height=1;y.addPixel(b)}}();window.registerFallbackHandler&&window.registerFallbackHandler(function(a,d,b,e,f){c("cse",g(a+"::stack::"+(a.stack||"no stack trace"),d,b,e,f))});new a({start:"load",limit:1,element:window,after:function(){c("csm",w())}});new a({start:"dra-creative-rendered",limit:1,custom:!0,after:function(a,d,b){c("csi",{type:"renderTime",renderTime:b.renderTime,csmLoadTimestamp:t})}});new a({start:"load",limit:1,element:window,after:function(){if(window.performance&&
window.performance.timing)var a=setInterval(function(){0!==window.performance.timing.loadEventEnd&&(clearInterval(a),c("csi",{type:"performanceTiming",performanceTiming:window.performance.timing}))},50)}});new a({start:"mouseover",limit:1,after:function(a){c("csi",{type:"touch",touchStart:a})}});new a({start:"mouseover",end:"mouseout",limit:1,b:500,after:function(a,d){c("csi",{type:"hover",hoverStart:a,hoverDuration:d})}});new a({start:"play",end:["pause","ended"],limit:1,b:0,after:function(a,d){c("csi",
{type:"play",playStart:a,playTime:d})}});new a({start:"dra-video-playallowed",custom:!0,limit:1,after:function(){c("csi",{type:"dra-video-playallowed"})}});new a({start:"dra-video-playblocked",custom:!0,limit:1,after:function(){c("csi",{type:"dra-video-playblocked"})}});new a({start:"dra-visible",custom:!0,limit:1,after:function(a,d,b){0<b&&c("csi",{type:"dra-hidden-ad-rendered",hiddenTimeMs:b})}});new a({start:"dra-visibility-polling-timeout",custom:!0,limit:1,after:function(a,d,b){c("csi",{type:"dra-hidden-ad-timeout",
hiddenTimeMs:b})}});new a({start:"dra-landscape",custom:!0,limit:1,after:function(){c("csi",{type:"landscape",landscape:!0})}});new a({start:"dra-portrait",custom:!0,limit:1,after:function(){c("csi",{type:"landscape",landscape:!1})}});new a({start:"click",after:function(a,d,b){a=x(b);d=k.getElementById("dra-body");c("csi",{type:"click",clickX:a.pageX,clickY:a.pageY,bodySize:d?d.offsetWidth+"x"+d.offsetHeight:void 0})}});new a({start:"simulate-click-unsupported",custom:!0,limit:1,after:function(a,
d,b){c("csi",{type:"simulate-click-unsupported",useragent:b&&"string"===typeof b[0]?b[0].substring(0,512):"NONE"})}});new a({start:"dra-osdetect-error",custom:!0,limit:1,after:function(a,d,b){c("cse",g(b?"MoPub userAgent mismatch: Provided: "+b[0]+"; Actual: "+b[1]+"; Raw User Agent: "+(e.navigator&&e.navigator.userAgent?e.navigator.userAgent.substring(0,512):"NONE"):"MoPub userAgent mismatch",void 0,void 0,void 0,"dra-osdetect-error"))}});new a({start:"dra-nexage-openinbrowser-timeout",custom:!0,
limit:1,after:function(){c("cse",g("Nexage SDK openInBrowser timeout",void 0,void 0,void 0,"dra-nexage-openinbrowser-timeout"))}});new a({start:"dra-aman-msdkbridge-error",custom:!0,limit:1,after:function(a,d,b){c("cse",g(b.amazon?"amazon.openInExternalBrowser \x3d "+typeof b.amazon.openInExternalBrowser:"amazon bridge missing",void 0,void 0,void 0,"dra-aman-msdkbridge-error"))}});new a({start:"pretrashed",limit:1,custom:!0,after:function(a,d,b){c("csi",{type:"pretrashed",trashGroups:b.trashGroups})}});
new a({start:"trashed",limit:10,custom:!0,after:function(a,d,b){c("trashing",{type:"trashed",trashGroups:b.trashGroups,trashReason:b.trashReason})}});new a({start:"restored",limit:10,custom:!0,after:function(a,d,b){c("trashing",{type:"restored",trashGroups:b.trashGroups})}});new a({start:"loaded-media-video",limit:1,custom:!0,after:function(a,d,b){c("csi",{type:"media-loaded",mediaType:"video",timeToLoadMedia:b.timeToLoadMedia})}});new a({start:"loaded-media-img",limit:1,custom:!0,after:function(a,
d,b){c("csi",{type:"media-loaded",mediaType:"img",mediaFallbackReason:b.mediaFallbackReason,timeToLoadMedia:b.timeToLoadMedia})}});new a({start:"tmp-img-loaded",limit:1,custom:!0,after:function(){c("csi",{type:"tmp-img-loaded"})}})},formatPetsEvent:s}});