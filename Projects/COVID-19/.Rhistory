) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total
) %>%
mutate(
new_cases = total_cases - lag(total_cases, 1),
new_deaths = total_deaths - lag(total_deaths, 1)
)
head(us_states_covid_data)
us_states_covid_data = read_csv('http://covidtracking.com/api/states/daily.csv') %>%
mutate(
date = as.Date(as.character(date), format = '%Y%m%d')
) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total
)
head(us_states_covid_data)
us_states_covid_data = read_csv('http://covidtracking.com/api/states/daily.csv') %>%
mutate(
date = as.Date(as.character(date), format = '%Y%m%d')
) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total
) %>%
mutate(
new_cases = total_cases - lag(total_cases, 1),
new_deaths = total_deaths - lag(total_deaths, 1)
)
us_states_covid_data = read_csv('http://covidtracking.com/api/states/daily.csv') %>%
mutate(
date = as.Date(as.character(date), format = '%Y%m%d'),
location_type = 'US State',
data_source = 'covidtracking.com'
) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total,
location = state
) %>%
mutate(
location_key = paste(location, location_type, data_source, sep = '|'),
new_cases = total_cases - lag(total_cases, 1),
new_deaths = total_deaths - lag(total_deaths, 1)
)
head(us_states_covid_data)
all_covid_data_stacked = bind_rows(all_covid_data, us_covid_data, us_states_covid_data)
us_total_cases = filter(all_covid_data_stacked, location == 'United States')
all_covid_data_stacked = bind_rows(all_covid_data, us_covid_data, us_states_covid_data) %>%
data.table()
# compute first differences, pct changes, etc.
all_covid_data_diffs =
all_covid_data_stacked[, {
lag_value = lag(value, 1)
diff_value = value - lag_value
pct_change_value = diff_value / lag_value
lag_4_value = lag(value, 4)
lag_5_value = lag(value, 5)
lag_6_value = lag(value, 6)
list(
date = date,
value = value,
lag_value = lag_value,
diff_value = diff_value,
pct_change_value = pct_change_value,
lag_4_value = lag_4_value,
lag_5_value = lag_5_value,
lag_6_value = lag_6_value,
first_value = date[date == min(date)],
last_value = date[date == max(date)],
value_past_100 = min(date[value >= 100])
)
}, by = list(location_key, measure)] %>%
pivot_wider(
id_cols = c('location', 'date'),
names_from = 'measure',
values_from = c('value', 'lag_value', 'diff_value',
'pct_change_value', 'lag_4_value', 'lag_5_value',
'lag_6_value')
)
# compute first differences, pct changes, etc.
all_covid_data_diffs =
all_covid_data_stacked[, {
lag_value = lag(value, 1)
diff_value = value - lag_value
pct_change_value = diff_value / lag_value
lag_4_value = lag(value, 4)
lag_5_value = lag(value, 5)
lag_6_value = lag(value, 6)
list(
date = date,
value = value,
lag_value = lag_value,
diff_value = diff_value,
pct_change_value = pct_change_value,
lag_4_value = lag_4_value,
lag_5_value = lag_5_value,
lag_6_value = lag_6_value,
first_value = date[date == min(date)],
last_value = date[date == max(date)],
value_past_100 = min(date[value >= 100])
)
}, by = list(location_key, measure)] %>%
pivot_wider(
id_cols = c('location_key', 'date'),
names_from = 'measure',
values_from = c('value', 'lag_value', 'diff_value',
'pct_change_value', 'lag_4_value', 'lag_5_value',
'lag_6_value')
)
us = filter(all_covid_data_diffs, location == 'United States')
# compute first differences, pct changes, etc.
all_covid_data_diffs =
all_covid_data_stacked[, {
lag_value = lag(value, 1)
diff_value = value - lag_value
pct_change_value = diff_value / lag_value
lag_4_value = lag(value, 4)
lag_5_value = lag(value, 5)
lag_6_value = lag(value, 6)
list(
date = date,
value = value,
lag_value = lag_value,
diff_value = diff_value,
pct_change_value = pct_change_value,
lag_4_value = lag_4_value,
lag_5_value = lag_5_value,
lag_6_value = lag_6_value,
first_value = date[date == min(date)],
last_value = date[date == max(date)],
value_past_100 = min(date[value >= 100])
)
}, by = list(location_key, location, data_source, measure)] %>%
pivot_wider(
id_cols = c('location_key', 'location', 'data_source', 'date'),
names_from = 'measure',
values_from = c('value', 'lag_value', 'diff_value',
'pct_change_value', 'lag_4_value', 'lag_5_value',
'lag_6_value')
)
us = filter(all_covid_data_diffs, location == 'United States')
head(us)
table(us$data_source)
ggplot(us, aes(date, total_cases, colour = dta_source)) +
geom_line(size = 1)
ggplot(us, aes(date, value_total_cases, colour = dta_source)) +
geom_line(size = 1)
ggplot(us, aes(date, value_total_cases, colour = data_source)) +
geom_line(size = 1)
head(all_covid_data_stacked)
tail(all_covid_data_stacked)
all_covid_data_stacked = bind_rows(all_covid_data, us_covid_data, us_states_covid_data) %>%
arrange(location_key, date) %>%
data.table()
# compute first differences, pct changes, etc.
all_covid_data_diffs =
all_covid_data_stacked[, {
lag_value = lag(value, 1)
diff_value = value - lag_value
pct_change_value = diff_value / lag_value
lag_4_value = lag(value, 4)
lag_5_value = lag(value, 5)
lag_6_value = lag(value, 6)
list(
date = date,
value = value,
lag_value = lag_value,
diff_value = diff_value,
pct_change_value = pct_change_value,
lag_4_value = lag_4_value,
lag_5_value = lag_5_value,
lag_6_value = lag_6_value,
first_value = date[date == min(date)],
last_value = date[date == max(date)],
value_past_100 = min(date[value >= 100])
)
}, by = list(location_key, location, data_source, measure)] %>%
pivot_wider(
id_cols = c('location_key', 'location', 'data_source', 'date'),
names_from = 'measure',
values_from = c('value', 'lag_value', 'diff_value',
'pct_change_value', 'lag_4_value', 'lag_5_value',
'lag_6_value')
)
us = filter(all_covid_data_diffs, location == 'United States')
ggplot(us, aes(date, value_total_cases, colour = data_source)) +
geom_line(size = 1)
filter(us, str_detect(data_source, 'covid'))
# pull in COVID data, mostly from WHO
all_covid_data = read_csv('https://covid.ourworldindata.org/data/full_data.csv') %>%
arrange(location, date) %>%
mutate_if(is.numeric, function(x) ifelse(is.na(x), 0, x))
us_covid_data = read_csv('https://covidtracking.com/api/us/daily.csv') %>%
mutate(
date = as.Date(as.character(date), format = '%Y%m%d'),
location = 'United States',
location_type = 'country',
data_source = 'covidtracking.com',
location_key = paste(location, location_type, data_source, sep = '|')
) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total
) %>%
mutate(
new_cases = total_cases - lag(total_cases, 1),
new_deaths = total_deaths - lag(total_deaths, 1)
)
us_states_covid_data = read_csv('http://covidtracking.com/api/states/daily.csv') %>%
mutate(
date = as.Date(as.character(date), format = '%Y%m%d'),
location_type = 'US State',
data_source = 'covidtracking.com'
) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total,
location = state
) %>%
mutate(
location_key = paste(location, location_type, data_source, sep = '|'),
new_cases = total_cases - lag(total_cases, 1),
new_deaths = total_deaths - lag(total_deaths, 1)
)
all_covid_data_stacked = bind_rows(all_covid_data, us_covid_data, us_states_covid_data) %>%
arrange(location_key, date) %>%
pivot_longer(cols = c('new_cases', 'new_deaths', 'total_cases', 'total_deaths'),
names_to = c('measure'), values_to = 'value') %>%
filter(location != 'World') %>%
mutate(
location_type = 'country',
data_source = 'WHO-ourworldindata',
location_key = paste(location, location_type, data_source, sep = '|')
) %>%
data.table()
# compute first differences, pct changes, etc.
all_covid_data_diffs =
all_covid_data_stacked[, {
lag_value = lag(value, 1)
diff_value = value - lag_value
pct_change_value = diff_value / lag_value
lag_4_value = lag(value, 4)
lag_5_value = lag(value, 5)
lag_6_value = lag(value, 6)
list(
date = date,
value = value,
lag_value = lag_value,
diff_value = diff_value,
pct_change_value = pct_change_value,
lag_4_value = lag_4_value,
lag_5_value = lag_5_value,
lag_6_value = lag_6_value,
first_value = date[date == min(date)],
last_value = date[date == max(date)],
value_past_100 = min(date[value >= 100])
)
}, by = list(location_key, location, data_source, measure)] %>%
pivot_wider(
id_cols = c('location_key', 'location', 'data_source', 'date'),
names_from = 'measure',
values_from = c('value', 'lag_value', 'diff_value',
'pct_change_value', 'lag_4_value', 'lag_5_value',
'lag_6_value')
)
us = filter(all_covid_data_diffs, location == 'United States')
ggplot(us, aes(date, value_total_cases, colour = data_source)) +
geom_line(size = 1)
filter(us, str_detect(data_source, 'covid'))
# pull in COVID data, mostly from WHO
all_covid_data = read_csv('https://covid.ourworldindata.org/data/full_data.csv') %>%
arrange(location, date) %>%
mutate_if(is.numeric, function(x) ifelse(is.na(x), 0, x)) %>%
filter(location != 'World') %>%
mutate(
location_type = 'country',
data_source = 'WHO-ourworldindata',
location_key = paste(location, location_type, data_source, sep = '|')
)
us_covid_data = read_csv('https://covidtracking.com/api/us/daily.csv') %>%
mutate(
date = as.Date(as.character(date), format = '%Y%m%d'),
location = 'United States',
location_type = 'country',
data_source = 'covidtracking.com',
location_key = paste(location, location_type, data_source, sep = '|')
) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total
) %>%
mutate(
new_cases = total_cases - lag(total_cases, 1),
new_deaths = total_deaths - lag(total_deaths, 1)
)
us_states_covid_data = read_csv('http://covidtracking.com/api/states/daily.csv') %>%
mutate(
date = as.Date(as.character(date), format = '%Y%m%d'),
location_type = 'US State',
data_source = 'covidtracking.com'
) %>%
rename(
total_cases = positive,
total_deaths = death,
total_tests = total,
location = state
) %>%
mutate(
location_key = paste(location, location_type, data_source, sep = '|'),
new_cases = total_cases - lag(total_cases, 1),
new_deaths = total_deaths - lag(total_deaths, 1)
)
all_covid_data_stacked = bind_rows(all_covid_data, us_covid_data, us_states_covid_data) %>%
arrange(location_key, date) %>%
pivot_longer(cols = c('new_cases', 'new_deaths', 'total_cases', 'total_deaths'),
names_to = c('measure'), values_to = 'value') %>%
data.table()
# compute first differences, pct changes, etc.
all_covid_data_diffs =
all_covid_data_stacked[, {
lag_value = lag(value, 1)
diff_value = value - lag_value
pct_change_value = diff_value / lag_value
lag_4_value = lag(value, 4)
lag_5_value = lag(value, 5)
lag_6_value = lag(value, 6)
list(
date = date,
value = value,
lag_value = lag_value,
diff_value = diff_value,
pct_change_value = pct_change_value,
lag_4_value = lag_4_value,
lag_5_value = lag_5_value,
lag_6_value = lag_6_value,
first_value = date[date == min(date)],
last_value = date[date == max(date)],
value_past_100 = min(date[value >= 100])
)
}, by = list(location_key, location, data_source, measure)] %>%
pivot_wider(
id_cols = c('location_key', 'location', 'data_source', 'date'),
names_from = 'measure',
values_from = c('value', 'lag_value', 'diff_value',
'pct_change_value', 'lag_4_value', 'lag_5_value',
'lag_6_value')
)
us = filter(all_covid_data_diffs, location == 'United States')
ggplot(us, aes(date, value_total_cases, colour = data_source)) +
geom_line(size = 1)
ggplot(us, aes(date, pct_change_value, colour = data_source)) +
geom_line(size = 1)
ggplot(us, aes(date, pct_change_value_total_cases, colour = data_source)) +
geom_line(size = 1)
us_states = filter(all_covid_data_diffs, location_type == 'US State')
# compute first differences, pct changes, etc.
all_covid_data_diffs =
all_covid_data_stacked[, {
lag_value = lag(value, 1)
diff_value = value - lag_value
pct_change_value = diff_value / lag_value
lag_4_value = lag(value, 4)
lag_5_value = lag(value, 5)
lag_6_value = lag(value, 6)
list(
date = date,
value = value,
lag_value = lag_value,
diff_value = diff_value,
pct_change_value = pct_change_value,
lag_4_value = lag_4_value,
lag_5_value = lag_5_value,
lag_6_value = lag_6_value,
first_value = date[date == min(date)],
last_value = date[date == max(date)],
value_past_100 = min(date[value >= 100])
)
}, by = list(location_key, location, location_type, data_source, measure)] %>%
pivot_wider(
id_cols = c('location_key', 'location', 'location_type','data_source', 'date'),
names_from = 'measure',
values_from = c('value', 'lag_value', 'diff_value',
'pct_change_value', 'lag_4_value', 'lag_5_value',
'lag_6_value')
)
us = filter(all_covid_data_diffs, location == 'United States')
us_states = filter(all_covid_data_diffs, location_type == 'US State')
ggplot(us_states, aes(date, pct_change_value_total_cases, colour = data_source)) +
geom_line(size = 1)
ggplot(us_states, aes(date, pct_change_value_total_cases, colour = location)) +
geom_line(size = 1)
ggplot(us_states, aes(date, pct_change_value_total_cases, group = location)) +
geom_line(size = 1)
case_100_dates = group_by(all_covid_data_diffs, location_key) %>%
summarize(
date_case_100 = min(date[value_total_cases >= 100])
)
all_covid_data_diffs_dates = left_join(all_covid_data_diffs, case_100_dates) %>%
filter(date >= date_case_100) %>%
mutate(
days_since_case_100 = as.numeric(date - date_case_100)
)
daily_growth_stats = group_by(all_covid_data_diffs_dates, days_since_case_100) %>%
summarize(
n_countries = n_distinct(location),
median_daily_change_cases = median(pct_change_value_total_cases, na.rm = T),
mean_daily_change_cases = mean(pct_change_value_total_cases, na.rm = T),
mean_daily_change_deaths = mean(pct_change_value_total_deaths, na.rm = T),
median_daily_change_deaths = median(pct_change_value_total_deaths, na.rm = T)
)
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States'), aes(line_type = data_source), colour = 'red') +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States'), aes(linetype = data_source), colour = 'red') +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States'),
aes(linetype = data_source), colour = 'red', size = 1) +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States', data_source == 'covidtracking.com'),
aes(linetype = data_source), colour = 'red', size = 1) +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States', data_source == 'covidtracking.com'),
colour = 'red', size = 1) +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States', data_source == 'covidtracking.com'),
colour = 'red', size = 1) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'Italy'), colour = 'forestgreen'),
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States', data_source == 'covidtracking.com'),
colour = 'red', size = 1) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'Italy'), colour = 'forestgreen') +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
table(all_covid_data_diffs_dates$location)
ggplot(all_covid_data_diffs_dates, aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States', data_source == 'covidtracking.com'),
colour = 'red', size = 1) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'Italy'), colour = 'forestgreen', size = 1) +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates %>% filter(location_type == 'US State'), aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States', data_source == 'covidtracking.com'),
colour = 'red', size = 1) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'Italy'), colour = 'forestgreen', size = 1) +
scale_y_continuous(limits = c(0, 1)) +
scale_alpha(range = c(0.1, 1)) +
geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
ggplot(all_covid_data_diffs_dates %>% filter(location_type == 'US State'), aes(days_since_case_100, pct_change_value_total_cases)) +
geom_line(aes(alpha = days_since_case_100, group = location)) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'United States', data_source == 'covidtracking.com'),
colour = 'red', size = 1) +
geom_line(data = filter(all_covid_data_diffs_dates, location == 'Italy'), colour = 'forestgreen', size = 1) +
scale_y_continuous(limits = c(0, 1)) +
# geom_line(data = daily_growth_stats %>% filter(n_countries >= 5), aes(x = days_since_case_100, y = median_daily_change_cases), size = 1, colour = 'blue')
scale_alpha(range = c(0.1, 1))
# pull in COVID data, mostly from WHO
all_covid_data = read_csv('https://covid.ourworldindata.org/data/full_data.csv') %>%
arrange(location, date) %>%
mutate_if(is.numeric, function(x) ifelse(is.na(x), 0, x)) %>%
filter(location != 'World') %>%
mutate(
location_type = 'country',
data_source = 'WHO-ourworldindata',
location_key = paste(location, location_type, data_source, sep = '|')
)
filter(all_covid_data, location == 'Italy') %>% tail(1)
johns_hopkins = read_csv('https://github.com/CSSEGISandData/COVID-19/blob/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv')
johns_hopkins_cases = read_csv('https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv')
head(johns_hopkins_cases)
table(johns_hopkins_cases$`Province/State`)
library(USAboundaries)
us_cities_shp = us_cities()
install.packages("USAboundariesData", repos = "http://packages.ropensci.org", type = "source")
